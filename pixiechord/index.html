<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="viewport" content="width=device-width">
    <title>Pixie Chord</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.19.0/dist/phaser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>
    class TitleScene extends Phaser.Scene {
        constructor() {
            super({key:'TitleScene', active: true});
        }
        preload () {
            // TODO rename all assets to be same as variable name... :D
            this.load.image('thePixieChord', 'assets/thePixieChord.png');
        }
        create() {
            // TODO get canvas size.
            var rect = new Phaser.Geom.Rectangle(0, 0, 450, 800);
            var background = this.add.graphics({ fillStyle: { color: 0x444444 } });
            background.fillRectShape(rect);

            this.add.text(0, 0, 'The Pixie Chord\nピクシーコード\nPikushīkōdo', { fill: '#fff' })
                .setFontSize(36);

            this.add.image(0, 100, 'thePixieChord').setOrigin(0, 0)
                .setScale(12);

            this.add.text(0, 700, 'New Game\n新しいゲーム\nAtarashī gēmu', { fill: '#fff' })
                .setFontSize(20)
                .setInteractive()
                // TODO better way to change scenes.
                .on('pointerdown', () => this.scene.sendToBack() );
        }
    }
    class HowToPlayScene extends Phaser.Scene {
        constructor() {
            super({key:'HowToPlayScene', active: true});
        }
        create() {
            var rect = new Phaser.Geom.Rectangle(0, 0, 450, 800);
            var background = this.add.graphics({ fillStyle: { color: 0x001100 } });
            background.fillRectShape(rect);

            this.add.text(0, 0, 'How to play\n遊び方\nAsobikata', { fill: '#fff' })
                .setFontSize(36);

            this.add.text(0, 200, 'Walk around.\n歩き回る\nArukimawaru', { fill: '#fff' })
                .setFontSize(20);
            this.add.text(50, 270, 'Play music.\n音楽を再生\nOngaku o saisei', { fill: '#fff' })
                .setFontSize(20);
            this.add.text(100, 340, 'Collect pets.\nペットを集める\nPetto o atsumeru', { fill: '#fff' })
                .setFontSize(20);

            this.add.text(250, 700, 'Next\n次\nTsugi', { fill: '#fff' })
                .setFontSize(20)
                .setInteractive()
                // TODO better way to change scenes.
                .on('pointerdown', () => this.scene.sendToBack() );
        }
    }
    class CatchPetsScene extends Phaser.Scene {
        constructor() {
            super({key:'CatchPetsScene', active: true});
            // TODO How to declare member var in a class?
            this.pianoKeys = [4];
            this.notesPlayed = "";
            this.notesPlayedText;
        }
        preload () {
            this.load.spritesheet('catchPet', 'assets/catchPet.png', { frameWidth: 16, frameHeight: 16 });
            this.load.spritesheet('petsX16', 'assets/petsX16.png', { frameWidth: 16, frameHeight: 16 });
        }
        create() {
            var rect = new Phaser.Geom.Rectangle(0, 0, 450, 800);
            var background = this.add.graphics({ fillStyle: { color: 0xeeeeee } });
            background.fillRectShape(rect);
            
            this.add.text(20, 20, 'Menu\nxxx\nmen00', { fill: '#000' })
                .setFontSize(20)
                .setInteractive()
                // TODO better way to change scenes.
                .on('pointerdown', () => {
                    this.scene.sendToBack(); 
                    this.notesPlayed = ""; 
                });

            var bubble = this.add.sprite(this.game.canvas.width / 2, this.game.canvas.height / 2, 'catchPet')
                .setFrame([0]).setInteractive()
                .setScale(3);

            var note = this.add.sprite(this.game.canvas.width / 2, this.game.canvas.height * 5/8, 'catchPet')
                .setFrame([1]).setInteractive()
                .setScale(3);

            this.notesPlayedText = this.add.text(this.game.canvas.width / 3, this.game.canvas.height * 6/8, "Tap\nbuttons", { fill: '#000' })
                .setFontSize(36);

            this.addPianoKey(0, this.game.canvas.width * 1/5, this.game.canvas.height * 7/8, "F");
            this.addPianoKey(1, this.game.canvas.width * 2/5, this.game.canvas.height * 7/8, "A");
            this.addPianoKey(2, this.game.canvas.width * 3/5, this.game.canvas.height * 7/8, "C");
            this.addPianoKey(3, this.game.canvas.width * 4/5, this.game.canvas.height * 7/8, "F");
        }
        addPianoKey(index, x, y, label) {
            this.pianoKeys[index] = this.add.sprite(x, y, 'catchPet')
                .setFrame([2]).setInteractive()
                .on('pointerdown', () => this.onPianoKeyPress(index) )
                .setScale(3);
            var text = this.add.text(x - 6, y - 8, label, { fill: '#000' })
                .setFontSize(20);
            this.pianoKeys[index].text = text;
            this.pianoKeys[index].label = label;
            return this.pianoKeys[index];
        }
        onPianoKeyPress(index) {
            console.log("onPianoKeyPress " + index + " lebel " + this.pianoKeys[index].label);
            this.notesPlayed = this.notesPlayed + this.pianoKeys[index].label;
            this.notesPlayedText.text = this.notesPlayed;
            if (this.notesPlayed.length >= 4) {
                
                var petIndex = this.notesPlayed.length;
                var petName = window.pets[petIndex].name;

                console.log("Summon petIndex " + petIndex + " name " + petName);

                var bubble = this.add.sprite(this.game.canvas.width / 2, this.game.canvas.height / 2, 'petsX16')
                    .setFrame([petIndex]).setInteractive()
                    .setScale(3);

                this.notesPlayedText.text = petName;
            }
        }
    }

    var pets = {
        petsX16: [
            { name: "Mr. Who Knows", composerId: 1 },
            { name: "Money Man", composerId: 1 },
            { name: "Mr. Wormhole", composerId: 1 },
            { name: "Herp Derp", composerId: 1 },
            { name: "Ninja Waffle", composerId: 1 },
            { name: "Mr. Happy", composerId: 1 },
            //
            { name: "Lightning Guy", composerId: 1 },
            { name: "Mr. Muffin", composerId: 1 },
            { name: "Weird Moana Wave", composerId: 1 },
            { name: "Poetion", composerId: 1 },
            { name: "Shakey", composerId: 1 },
            { name: "Glowy Kittie", composerId: 1 },
            //
            { name: "Achoo!", composerId: 2 },
            { name: "THE Watermelon", composerId: 2 },
            { name: "Abe Lincoln Hat", composerId: 2 },
            { name: "Roundoso ", composerId: 2 },
            { name: "Mitty Merfow", composerId: 3 },
            { name: "Thâ€™nana", composerId: 3 },
            //
            { name: "Peet Limuh", composerId: 6 },
            { name: "N-Type", composerId: 6 },
            { name: "Mookauk", composerId: 7 },
            { name: "Hovering Mookauk ", composerId: 7 },
            { name: "Mr. Stinker", composerId: 8 },
            { name: "Manstein ", composerId: 8 },
            //
            { name: "Hot dog", composerId: 1 },
            { name: "Mr. Sundae", composerId: 1 },
            { name: "Random Dude", composerId: 1 },
            { name: "Mouse in a Bottle", composerId: 1 },
            { name: "Scriblins ", composerId: 1 },
            { name: "Derpy Hammer", composerId: 1 },
            //
            { name: "Randall Elf", composerId: 12 },
            { name: "Moana", composerId: 12 },
            { name: "JEFFREY", composerId: 12 },
            { name: "MIZZ KITTEH", composerId: 12 },
            { name: "RICHARD", composerId: 12 },
            { name: "RACHEL", composerId: 12 },
            //
            { name: "Twindle", composerId: 13 },
            { name: "Balloon Maestro ", composerId: 13 },
            { name: "Fancy Nance", composerId: 13 },
            { name: "Pineapple Jimmy", composerId: 13 },
            { name: "Sprizter", composerId: 13 },
            { name: "Yogurt", composerId: 13 },
            //
            { name: "Dr. Weird", composerId: 10 },
            { name: "Mr. McWiggles", composerId: 10 },
            { name: "Mr. Blob", composerId: 10 },
            { name: "Mrs. Blob", composerId: 10 },
            { name: "Cubie ", composerId: 10 },
            { name: "Mr. Mutant", composerId: 10 },
            //
            { name: "Hapfo", composerId: 3 },
            { name: "Duck", composerId: 3 },
            { name: "Rrakerfunshuck", composerId: 3 },
            { name: "Twister", composerId: 3 },
            { name: "Mr. Shapership", composerId: 3 },
            { name: "Treeman", composerId: 3 },
            //
            { name: "Blubble Blobble", composerId: 5 },
            { name: "CABC", composerId: 5 },
            { name: "Mr. Zezo", composerId: 5 },
            { name: "Blankoot", composerId: 5 },
            { name: "Wormy", composerId: 5 },
            { name: "Apoo Sauce", composerId: 5 },
            //
            { name: "Smoker", composerId: 8 },
            { name: "Nuggle ", composerId: 9 },
            { name: "Thernifuh", composerId: 9 },
            { name: "Shentuh ", composerId: 9 },
            //
            { name: "Crazy-nazy ", composerId: 3 },
            { name: "Bobomoo ", composerId: 3 },
            { name: "Gaga ", composerId: 3 },
            { name: "Â¥XJÄ™RBÂ¡'Å‚Ä¯Ã¸Ã¦ÃŸÄ", composerId: 3 },
            //
            { name: "Baby Mister", composerId: 4 },
            { name: "Mighty Footer", composerId: 4 },
            { name: "Nolr ", composerId: 4 },
            { name: "Smix ", composerId: 4 }
        ],
        petsX24: [
            { name: "Moos`e", composerId: 2 },
            { name: "Squog", composerId: 2 },
            { name: "Dr. Witchy Joe", composerId: 3 },
            { name: "Bobby Joe ", composerId: 3 },
            { name: "Selly Joe", composerId: 3 },
            { name: "Jelly Jelloo", composerId: 3 },
            //
            { name: "Mooky Pucky", composerId: 6 },
            { name: "Meep Zorp!", composerId: 6 },
            { name: "Oxion-o", composerId: 6 },
            { name: "Glober", composerId: 9 },
            { name: "Mrs. Fluffy", composerId: 8 },
            { name: "Mr. Haedayse ", composerId: 8 },
            //
            { name: "Glanuf ", composerId: 9 },
            { name: "Jelber ", composerId: 9 },
            { name: "Burning Tails", composerId: 3 },
            { name: "Poochkin", composerId: 11 },
            { name: "Robozoid", composerId: 11 },
            ],
        petsX8: [
            { name: "Mini-pic", composerId: 6 },
            { name: "Kegando", composerId: 6 },
            { name: "Invisi-pic", composerId: 6 },
            { name: "Biv", composerId: 6 },
            { name: "Crabic ", composerId: 6 },
            { name: "Gondo ", composerId: 6 },
            { name: "Oofouwch", composerId: 3 },
            { name: "Arhgy ", composerId: 3 },
            { name: "Mbando", composerId: 3 },
            { name: "Mr. Potato Sack", composerId: 3 },
            { name: "Kyeeno ", composerId: 3 },
            { name: "Vramselder ", composerId: 3 },
            ]
        }

    var composers = [
        "No one. Because arrays start at zero and composerId starts at 1.",
        "Joe, Caller of Beasts",
        "Rosie",
        "D.J. Doctor Jimian Junior",
        "Wilma 'The Phenomenon'",
        "Miranin",
        "Jessemon Galacticon",
        "AMoose",
        "Bademo",
        "Nootch the Awesome",
        "Ace",
        "Sam",
        "Raekel",
        "Teelorj",
        "Ezra, Hero of Pickles",
    ];

    var config = {
        type: Phaser.AUTO,
        pixelArt: true, // Prevents image anti-alias when scaling up.  Also messes up default font.
        // I could reduce the game size and user ScaleManger to zoom in.  BTW, zoom is not a real config setting.  
        width: 450, // 9*50 = 450
        height: 800, // 16*50 = 800
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 200 }
            }
        },
        // Order here matters.  The first scene is listed last.
        scene: [CatchPetsScene, HowToPlayScene, TitleScene]
    };

    var game = new Phaser.Game(config);

    </script>

</body>
</html>